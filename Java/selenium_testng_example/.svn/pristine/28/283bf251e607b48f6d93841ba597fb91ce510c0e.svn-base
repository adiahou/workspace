package dxy.vs.base;

import static org.junit.Assert.assertTrue;

import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.PageFactory;

import dxy.vs.pages.DashboardPage;
import dxy.vs.pages.SimPage;

public class ReusableFunctions extends SetUp {
	
	//Initialize Pages
	SimPage simPage;
	DashboardPage dashboard;

    public void login(int Group) throws Exception{
    	
		//Instance pages
		simPage = PageFactory.initElements(threadDriver.get(), SimPage.class);
		dashboard = PageFactory.initElements(threadDriver.get(), DashboardPage.class);
		String pageURL = "";
		
		//load login page
        driver.get(p("sim_url"));
        Thread.sleep(3000);
        waitForElementExist(simPage.btn_submit);
        
        //fill username/password
        System.out.println(p("user"));
        System.out.println(p("pw"));
        input(simPage.input_user, p("user"));
        input(simPage.input_pw, p("pw"));
        
        //click submit
        simPage.btn_submit.click();
        waitForPageLoadComplete();
        pageURL = driver.getCurrentUrl();
		if(pageURL.contains("https://sim.dxy.cn/japi/login")){
			driver.get(p("sim_url_vs"));
			 Thread.sleep(1000);
			waitForPageLoadComplete();		
		}
        
        waitForElementExist(simPage.tab_VS);

        //click VS tab
        simPage.tab_VS.click();
        waitForElementExist(simPage.group_VSDXY);
        
        //click  group
        if(Group == 1){
        	simPage.group_VSLilly.click();
        	waitForElementExist(simPage.btn_enterVS);
            
            //click to enter VS
            simPage.btn_enterVS.click();
            Thread.sleep(2000);
            switchToLastWindow();
            waitForPageLoadComplete();
            waitForElementExist(dashboard.text_dashboard);
            
            dashboard.selectLillySites();
            
        }else{
        	simPage.group_VSDXY.click();
        	 waitForElementExist(simPage.btn_enterVS);
             
             //click to enter VS
             simPage.btn_enterVS.click();
             Thread.sleep(2000);
             switchToLastWindow();
             waitForPageLoadComplete();
             waitForElementExist(dashboard.text_dashboard);
             
             dashboard.selectDemoSite();
        }
        
    }


    public  void logout(){
//        click(".dropdown-toggle");
//        click("a", withText("退出"));
//        await().atMost(5, TimeUnit.SECONDS).until("button").withText().contains("登录").isPresent();
    }
    
    /**
     * 验证页码按钮
     * @param content:列表中内容
     * @param btn_next
     * @param btn_previous
     * @param btn_last
     * @param btn_first
     */
	public  void verifyPaginations(WebElement content, WebElement btn_next,WebElement btn_previous,WebElement btn_last,WebElement btn_first) throws Exception{
		
		if(isElementExist(btn_next)){
			btn_next.click();
			Thread.sleep(1000);
	        waitForPageLoadComplete();
			assertTrue(isElementExist(content));

			btn_previous.click();
			Thread.sleep(1000);
	        waitForPageLoadComplete();
			assertTrue(isElementExist(content));

			btn_last.click();
			Thread.sleep(1000);
	        waitForPageLoadComplete();
			assertTrue(isElementExist(content));

			btn_first.click();
			Thread.sleep(1000);
	        waitForPageLoadComplete();
			assertTrue(isElementExist(content));
		}else{
			System.out.println("页码按钮不存在。");
		}
	}
    
	
	public  void switchToBackstage(String lastURL) throws Exception{
		
		int windowSize = threadDriver.get().getWindowHandles().size();
		System.out.println("Window Size after: "+windowSize);
		System.out.println("*********************************************************************************************************************************");
		
		if(windowSize>=3){
			driver.close();
		}

		switchToLastWindow();
		lastURL = lastURL+p("appid");
		driver.get(lastURL);
		Thread.sleep(1000);
        waitForPageLoadComplete();
	}
}
