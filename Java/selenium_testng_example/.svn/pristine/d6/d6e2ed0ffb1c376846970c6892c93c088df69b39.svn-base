package dxy.vs.pages;

import static org.junit.Assert.assertTrue;

import java.io.File;

import org.openqa.selenium.StaleElementReferenceException;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.PageFactory;

import dxy.vs.base.ReusableFunctions;
import dxy.vs.base.SetUp;

public class CMS_ManageVideoPage extends SetUp{

	@FindBy(xpath="//span[text()='内容系统']")
	public WebElement menu_CMS;
	
	@FindBy(xpath="//a[@href='/admin/content/cc']")
	public WebElement submenu_video;
	
	@FindBy(xpath="//button[text()='上传视频']")
	public WebElement btn_upload;
	
	@FindBy(xpath="//section[@class='content-header']/h1")
	public WebElement pageTitle;
	
	@FindBy(xpath="//input[@name='title']")
	public WebElement field_videoTitle;
	
	@FindBy(xpath="//input[@name='description']")
	public WebElement field_videoDesc;

	@FindBy(xpath="//input[@id='cc-file-field']")
	public WebElement field_videoFileUpload;

	@FindBy(xpath="//button[text()='开始上传']")
	public WebElement btn_startUpload;

	@FindBy(xpath="//div[contains(@class,'cc-upload-progress')]/div[text()='上传成功']")
	public WebElement msg_uploadSuccess;

	
	
	
	
	ReusableFunctions reusableFunctions = PageFactory.initElements(threadDriver.get(), ReusableFunctions.class);	
	
	public  void openVideoManagePage() throws Exception{
		
		menu_CMS.click();
		Thread.sleep(1000);
		submenu_video.click();
		waitForPageLoadComplete();
		waitForElementExist(btn_upload);
		
		assertTrue("页面标题错误",pageTitle.getText().contains("视频管理"));
	}

    public void uploadVideo() throws Exception{
    	
    	File downloadFileFolder = new File("testdata/test.flv");
    	String filePath = downloadFileFolder.getAbsolutePath();
    	
    	btn_upload.click();
    	Thread.sleep(1000);
    	waitForElementExist(field_videoFileUpload);
    	
    	try {
    	    Thread.sleep(1000);
        	field_videoFileUpload.sendKeys(filePath);
    	} catch (StaleElementReferenceException e) {
    	    e.printStackTrace();
    	}

    	field_videoTitle.sendKeys("Auto_videoTitle");
    	field_videoDesc.sendKeys("Auto_videoDescription");
    	
    	btn_startUpload.click();
    	waitForElementExist(msg_uploadSuccess,30);
    	
    	
    }
    
    public void verifyVideoList() {
    	//wait for video finished process for 20 min
    	int loop = 0;
    	boolean isfinished = false;
    	while(!isfinished){
    		driver.navigate().refresh();
    		waitForPageLoadComplete();
    	}
    	
    	
    }


}
